@(searchResult: SearchResponse)(matchResponse: MatchResponse)

@main("search") {

    <body onload="initializeAutocomplete(document)">
		<section>
		<div class="container">
        <form name="searchRoute" action="@routes.RouteActions.search()" method="post">
            <div class="col-xs-12">
			<label>Starting Address</label>
            <input class="form-control" id="startAddress" type="text" name="startAddress" value="" placeholder="Enter Location" onFocus="geolocate()" />
            <input type="checkbox" name="autoStart" checked="yes" value="Auto">Auto
            </div>
			<br>
			<div class="col-xs-12">
            <label>Destination Address</label>
            <input class="form-control" id="endAddress" type="text" name="endAddress" value="" placeholder="Enter Location" onFocus="geolocate()" />
            <input type="checkbox" name="autoEnd" value="Auto">Auto
            </div>
			<br>
			<div class="col-xs-4">
            <label>Date</label>
            <input class="form-control" name="date" type="date" placeholder="30.12.2015" />
            <br>
			</div>
			<div class="col-xs-4">
            <label>Time</label>
            <input class="form-control col-xs-2" name="time"  placeholder="20:30"/>
            <br>
			</div>

			<div class="col-xs-12">
            <input class="btn btn-success" type="submit" value="Search">
			</div>
        </form>
		</div>
		<hr style="margin-top:40px; margin-bottom:40px">
        <div class="container" >
            <h3>Matched Patterns</h3>
            <table class="table table-striped table-bordered">
                <tr>
                    <th>
                        Start Address
                    </th>
                    <th>
                        Destination Address
                    </th>
                    <th>
                        Puncuality Address
                    </th>
                    <th>
                        Start Address
                    </th>
                    <th>
                        Start Address
                    </th>
                </tr>
            </table>

            <h3>Statistics</h3>
            @if(!searchResult.Stop.equals("")) {
                @if(!searchResult.Start.equals("")) {
                    You have searched route <b>from @searchResult.Start to @searchResult.Stop</b>
                    <br>
                    @searchResult.ExactMatches users have searched this route
                    <br><br>
                }
            }

            @if(!searchResult.Start.equals("")) {
                <b>Searches starting in @searchResult.Start (@searchResult.StartMatches occurances)</b>

                <table class="table table-striped table-bordered">
                    <tr>
                        <th>
                            Destination Address
                        </th>
                        <th>
                            Frequency
                        </th>
                    </tr>
                    @for(a <- searchResult.StartArea) {
                        <tr>
                            <td>
                            @a.area
                            </td>
                            <td>
                            @a.occurances
                            </td>
                        </tr>
                    }
                </table>
            }


            @if(!searchResult.Stop.equals("")) {
                <b>Searches with destination in @searchResult.Stop (@searchResult.EndMatches occurances)</b>

                <table class="table table-striped table-bordered">
                    <tr>
                        <th>
                            Start Address
                        </th>
                        <th>
                            Frequency
                        </th>
                    </tr>
                    @for(a <- searchResult.DestinationAreas) {
                        <tr>
                            <td>
                            @a.area
                            </td>
                            <td>
                            @a.occurances
                            </td>
                        </tr>
                    }
                </table>
            }
            <hr style="margin-top:40px; margin-bottom:40px">
            @if(!matchResponse.routePatterns.isEmpty) {
                <div>
                    <h3>Matchings found:</h3>
                </div>
                <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                @for((k, v) <- matchResponse.routePatterns) {


                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingOne">
                            <div class="panel-title">
                                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse@(k.routePatternId)" aria-expanded="false" aria-controls="collapse@(k.routePatternId)">
                                    <p><b>Start:</b> @(k.startAddress)</br>
                                        <b>End:</b> @(k.endAddress)</br></p>
                                </a>
                            </div>
                        </div>
                        <div id="collapse@(k.routePatternId)" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                            <div class="panel-body">



                                <form name="deletePattern" action="@routes.RouteActions.deletePattern()" method="post">
                                    <input id="patternId" name="patternId" value="@(k.routePatternId)" type="hidden" />
                                    <input type="submit" class="btn btn-default btn-sm" value="Delete this pattern!">
                                </form>

                                <h4>The following users have similar journeys:</h4>
                                @for((r, value) <- v) {
                                    <div>

                                        <div class="panel panel-default">
                                            <div class="panel-body">

                                                <ul class="list-group">
                                                    <div class="col-xs-6">
                                                        <li><label>PatternUser: @(r.userId) </label></li>
                                                        <li><label>PatternStart: @(r.startAddress) </label></li>
                                                        <li><label>PatternEnd: @(r.endAddress) </label></li>
                                                    </div>
                                                    <div class="col-xs-6">
                                                        <li><label>PatternTime: @(r.time) </label></li>
                                                        <li><label>PatternDate: @(r.date) </label></li>
                                                        <li><label>PatternPeriodicity: @(r.periodicity) </label></li>
                                                        <li><label>PatternPeriodicity: @(value.toString) </label></li>
                                                    </div>

                                                </ul>
                                            </div>
                                            <div  class="panel-footer">
                                                <input type="submit" class="btn btn-default btn-info btn-sm"
                                                value="Show on map!"
                                                onclick="showRoute(@(r.startLat), @(r.startLong), @(r.endLat), @(r.endLong))">
                                            </div>
                                        </div>
                                    </div>
                                    </br>


                                }
                            </div>
                        </div>
                    </div>
                }




                </div>
            }
        </div>



        <div class="container" id="mapContainer" style="height: 600px ; margin: 0px auto;"; >
                <!-- This is where Google map will go. -->
        </div>
	</section>
    </body>

    <script>
    var mapContainer = $( "#mapContainer" );
        var map = // above the first Geolocated IP address.
                map = new google.maps.Map(
                    mapContainer[ 0 ],
                    {
                        zoom: 15,
                        center: new google.maps.LatLng(
                            40.700683,
                            -73.925972
                        ),
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    }
                );
        pinpointMe(document, map);
        function showRoute(startLat, startLong, endLat, endLong) {
                var mapContainer = $( "#mapContainer" );
                showRouteOnMap(document, mapContainer, map, startLat, startLong, endLat, endLong);
        }
    </script>
}
